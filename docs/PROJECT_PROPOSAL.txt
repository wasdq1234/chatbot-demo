================================================================================
                         프로젝트 제안서
          NLP 기반 대화형 AI Agent 설계 및 개발
================================================================================


1. 프로젝트 개요
================================================================================

1.1 프로젝트 소개
--------------------------------------------------------------------------------
자연어 처리(NLP) 기반 대화형 AI Agent를 설계 및 개발하는 프로젝트입니다.
위치 기반 서비스와 신용카드 혜택 데이터를 결합한 추천 알고리즘 및
RAG(Retrieval-Augmented Generation) 시스템 구축을 목표로 합니다.

1.2 프로젝트 목표
--------------------------------------------------------------------------------
- 사용자 의도를 정확히 파악하는 대화형 AI Agent 개발
- 위치 기반 서비스와 카드 혜택 데이터를 결합한 개인화 추천 시스템 구현
- 실시간 응답이 가능한 고성능 시스템 구축
- LangSmith/LangGraph Studio를 활용한 체계적인 모니터링 및 디버깅 환경 구축

1.3 프로젝트 일정
--------------------------------------------------------------------------------
| 구분           | 일정                      |
|----------------|---------------------------|
| 전체 기간      | 2개월 (협의 후 연장 가능) |
| 투입 예정일    | ASAP                      |
| 계약 결정      | 인터뷰 후 1~2주 이내      |


2. 시스템 아키텍처
================================================================================

2.1 전체 시스템 구성도
--------------------------------------------------------------------------------

  Client (Web/Mobile)
          |
          v
  +------------------+
  | FastAPI Backend  |  <-- REST API + SSE Streaming
  +------------------+
          |
    +-----+-----+
    |           |
    v           v
+--------+  +----------+     +-------------+
| Chroma |  | LangGraph|---->| OpenAI API  |
|(VectorDB) | (Agent)  |     | (LLM)       |
+--------+  +----------+     +-------------+
                |
                v
    +------------------------+
    | LangSmith (Monitoring) |
    +------------------------+


2.2 AI Agent 워크플로우 (LangGraph)
--------------------------------------------------------------------------------

  START --> Retrieve (문서 검색) --> Generate (LLM 응답) --> END

  [상태 관리]
  - question: 사용자 질문
  - context: 검색된 문서
  - answer: 생성된 응답


3. 핵심 기능 상세
================================================================================

3.1 대화형 AI Agent
--------------------------------------------------------------------------------
| 기능           | 설명                                                      |
|----------------|-----------------------------------------------------------|
| 의도 파악      | 사용자 질문에서 의도(위치 검색, 카드 추천, 일반 질문) 분류 |
| 컨텍스트 이해  | 대화 히스토리 기반 문맥 파악 및 연속 대화 지원             |
| 멀티턴 대화    | 이전 대화 내용을 기억하고 자연스러운 대화 흐름 유지        |
| 스트리밍 응답  | SSE 기반 실시간 토큰 단위 응답 전송                        |

3.2 RAG 시스템
--------------------------------------------------------------------------------
| 구성 요소       | 기술                          | 설명                       |
|-----------------|-------------------------------|----------------------------|
| Document Loader | LangChain                     | 다양한 형식의 문서 로드    |
| Text Splitter   | RecursiveCharacterTextSplitter| 청크 분할 (1000자, 200자)  |
| Embeddings      | OpenAI Embeddings             | 텍스트 벡터화              |
| Vector Store    | ChromaDB                      | 벡터 저장 및 유사도 검색   |
| Retriever       | LangChain Retriever           | Top-K 문서 검색 (k=3)      |

3.3 추천 알고리즘
--------------------------------------------------------------------------------
위치 기반 카드 혜택 추천 로직:

1. 현재 위치 주변 가맹점 검색
2. 사용자 보유 카드의 혜택 조회
3. 가맹점별 최적 카드 매칭
4. 혜택 순으로 정렬하여 반환

3.4 실시간 응답 최적화
--------------------------------------------------------------------------------
| 전략          | 구현 방법                                    |
|---------------|----------------------------------------------|
| 스트리밍      | SSE (Server-Sent Events) 기반 토큰 단위 전송 |
| 비동기 처리   | FastAPI async/await 활용                     |
| 연결 풀링     | 데이터베이스 커넥션 풀 관리                  |


4. LangSmith & LangGraph Studio 활용
================================================================================

4.1 LangSmith 모니터링
--------------------------------------------------------------------------------
LangSmith는 LLM 애플리케이션의 전체 라이프사이클을 관리하는 플랫폼입니다.

[주요 활용 방안]

| 기능         | 활용 내용                                              |
|--------------|--------------------------------------------------------|
| Tracing      | 모든 LLM 호출, 체인 실행, 임베딩 요청을 자동 추적      |
| Debugging    | 오류 발생 시 전체 실행 흐름을 시각적으로 분석          |
| Performance  | 응답 시간, 토큰 사용량, 비용 모니터링                  |
| Evaluation   | 응답 품질 평가 및 A/B 테스트                           |

[환경 설정]

.env 파일:
    LANGSMITH_TRACING=true
    LANGSMITH_API_KEY=your_langsmith_api_key
    LANGSMITH_PROJECT=ai-agent-production
    LANGSMITH_ENDPOINT=https://api.smith.langchain.com

[자동 트레이싱 구현]

app/core/config.py:

    import os
    from dotenv import load_dotenv

    load_dotenv()

    class Settings:
        # LangSmith 설정
        LANGSMITH_TRACING: bool = os.getenv("LANGSMITH_TRACING", "false").lower() == "true"
        LANGSMITH_API_KEY: str = os.getenv("LANGSMITH_API_KEY", "")
        LANGSMITH_PROJECT: str = os.getenv("LANGSMITH_PROJECT", "chatbot-demo")

    def configure_langsmith():
        """LangSmith 트레이싱 자동 설정"""
        if settings.LANGSMITH_TRACING and settings.LANGSMITH_API_KEY:
            os.environ["LANGSMITH_TRACING"] = "true"
            os.environ["LANGSMITH_API_KEY"] = settings.LANGSMITH_API_KEY
            os.environ["LANGSMITH_PROJECT"] = settings.LANGSMITH_PROJECT
            return True
        return False

[LangSmith 대시보드 주요 지표]

- Total Runs: 전체 실행 횟수
- Success Rate: 성공률
- Avg Latency: 평균 응답 시간
- Total Cost: 총 비용
- Recent Runs: 최근 실행 이력 및 상태


4.2 LangGraph Studio 활용
--------------------------------------------------------------------------------
LangGraph Studio는 LangGraph 워크플로우를 시각화하고 디버깅하는 도구입니다.

[주요 활용 방안]

| 기능                  | 활용 내용                              |
|-----------------------|----------------------------------------|
| Graph Visualization   | 노드와 엣지 구조를 시각적으로 확인     |
| Step-by-Step Debugging| 각 노드 실행 결과를 단계별로 확인      |
| State Inspection      | 그래프 상태 변화를 실시간 모니터링     |
| Interactive Testing   | UI에서 직접 입력하여 테스트 실행       |

[LangGraph 설정]

langgraph.json:

    {
      "dependencies": ["."],
      "graphs": {
        "rag_chatbot": "./app/services/graph.py:graph",
        "recommendation": "./app/services/recommend_graph.py:graph"
      },
      "env": "./.env",
      "python_version": "3.11"
    }

[StateGraph 구현 예시]

app/services/graph.py:

    from typing import TypedDict
    from langgraph.graph import END, START, StateGraph

    class AgentState(TypedDict):
        """AI Agent 상태"""
        question: str
        intent: str
        context: str
        answer: str

    def parse_intent(state: AgentState) -> dict:
        """사용자 의도 파악"""
        intent = classify_intent(state["question"])
        return {"intent": intent}

    def retrieve_context(state: AgentState) -> dict:
        """의도에 따른 컨텍스트 검색"""
        if state["intent"] == "location":
            context = location_retriever.invoke(state["question"])
        elif state["intent"] == "card":
            context = card_retriever.invoke(state["question"])
        else:
            context = general_retriever.invoke(state["question"])
        return {"context": context}

    def generate_response(state: AgentState) -> dict:
        """LLM 응답 생성"""
        response = llm.invoke(
            f"Context: {state['context']}\nQuestion: {state['question']}"
        )
        return {"answer": response.content}

    # 그래프 빌드
    builder = StateGraph(AgentState)
    builder.add_node("parse_intent", parse_intent)
    builder.add_node("retrieve", retrieve_context)
    builder.add_node("generate", generate_response)

    builder.add_edge(START, "parse_intent")
    builder.add_edge("parse_intent", "retrieve")
    builder.add_edge("retrieve", "generate")
    builder.add_edge("generate", END)

    graph = builder.compile()

[LangGraph Studio 실행]

    # LangGraph CLI 설치
    pip install langgraph-cli[inmem]

    # 개발 서버 실행
    langgraph dev

    # 브라우저에서 http://localhost:2024 접속


4.3 모니터링 통합 활용
--------------------------------------------------------------------------------

[개발 단계]
- LangGraph Studio로 워크플로우 시각화 및 디버깅
- 각 노드 실행 결과 단계별 확인
- 상태 변화 실시간 모니터링

[운영 단계]
- LangSmith로 전체 시스템 트레이싱
- 성능 지표 모니터링 (응답 시간, 비용, 에러율)
- 이상 탐지 및 알림 설정


5. 기술 스택
================================================================================

5.1 핵심 기술
--------------------------------------------------------------------------------
| 분류          | 기술              | 용도                        |
|---------------|-------------------|-----------------------------|
| Language      | Python 3.11+      | 메인 개발 언어              |
| AI/ML         | OpenAI API        | LLM (GPT-4)                 |
|               | LangChain         | LLM 오케스트레이션          |
|               | LangGraph         | 상태 기반 워크플로우        |
|               | LangSmith         | 모니터링 & 트레이싱         |
| Vector DB     | ChromaDB          | 벡터 저장 및 검색           |
| Backend       | FastAPI           | REST API 서버               |
| Database      | PostgreSQL        | 주요 데이터 저장            |
|               | MongoDB           | 비정형 문서 저장            |
| Infrastructure| Naver Fin Cloud   | 클라우드 인프라             |
|               | Docker            | 컨테이너화                  |
|               | Kubernetes        | 오케스트레이션              |
| Messaging     | Apache Kafka      | 이벤트 스트리밍             |
| Search        | Elasticsearch     | 전문 검색                   |

5.2 개발 도구
--------------------------------------------------------------------------------
| 도구           | 용도              |
|----------------|-------------------|
| uv             | Python 패키지 관리|
| Git            | 버전 관리         |
| GitHub Actions | CI/CD             |
| pytest         | 테스트 프레임워크 |


6. 개발 로드맵
================================================================================

Phase 1: 기반 구축
--------------------------------------------------------------------------------
| 태스크      | 상세 내용                           | 완료 기준                  |
|-------------|-------------------------------------|----------------------------|
| 환경 설정   | 개발 환경, CI/CD 파이프라인 구축    | 로컬 및 클라우드 환경 동작 |
| 기본 RAG    | 문서 로드, 벡터화, 검색 구현        | RAG 파이프라인 동작 확인   |
| API 개발    | FastAPI 기반 REST API 구현          | 스트리밍 응답 동작 확인    |
| 모니터링    | LangSmith, LangGraph Studio 연동    | 트레이싱 데이터 확인       |

Phase 2: 핵심 기능
--------------------------------------------------------------------------------
| 태스크        | 상세 내용                         | 완료 기준                |
|---------------|-----------------------------------|--------------------------|
| 의도 분류     | 사용자 의도 파악 모듈 개발        | 90% 이상 분류 정확도     |
| 위치 서비스   | 위치 기반 검색 기능 구현          | 주변 가맹점 검색 동작    |
| 카드 혜택     | 카드 혜택 데이터 연동             | 혜택 정보 조회 동작      |
| 추천 알고리즘 | 위치-카드 혜택 매칭 알고리즘      | 추천 결과 검증           |

Phase 3: 고도화
--------------------------------------------------------------------------------
| 태스크      | 상세 내용                           | 완료 기준                |
|-------------|-------------------------------------|--------------------------|
| 멀티턴 대화 | 대화 컨텍스트 관리                  | 연속 대화 자연스럽게     |
| 성능 최적화 | 캐싱, 비동기 처리 최적화            | 응답 시간 1초 이내       |
| 에러 처리   | 예외 상황 처리 및 fallback          | 에러율 1% 미만           |
| 테스트      | 단위/통합/E2E 테스트                | 테스트 커버리지 80% 이상 |

Phase 4: 배포 및 안정화
--------------------------------------------------------------------------------
| 태스크      | 상세 내용                           | 완료 기준                |
|-------------|-------------------------------------|--------------------------|
| 컨테이너화  | Docker 이미지 빌드                  | K8s 배포 완료            |
| 부하 테스트 | 성능 테스트 및 튜닝                 | 목표 TPS 달성            |
| 문서화      | API 문서, 운영 가이드 작성          | 문서 완료                |
| 인수인계    | 코드 리뷰, 지식 전달                | 인수인계 완료            |


7. 산출물
================================================================================

| 구분         | 산출물                                           |
|--------------|--------------------------------------------------|
| 소스 코드    | Git 저장소 (브랜치 전략 적용)                    |
| API 문서     | OpenAPI (Swagger) 스펙                           |
| 설계 문서    | 시스템 아키텍처, ERD, 시퀀스 다이어그램          |
| 테스트       | 단위/통합/E2E 테스트 코드                        |
| 운영 문서    | 배포 가이드, 트러블슈팅 가이드                   |
| 모니터링     | LangSmith 대시보드, 알림 설정                    |


8. 현재 MVP 구현 현황
================================================================================

8.1 완료된 기능
--------------------------------------------------------------------------------
| 기능              | 상태     | 설명                                |
|-------------------|----------|-------------------------------------|
| 프로젝트 구조     | 완료     | FastAPI 기반 모듈화된 구조          |
| RAG 시스템        | 완료     | ChromaDB + OpenAI Embeddings        |
| 스트리밍 API      | 완료     | SSE 기반 실시간 응답                |
| 테스트 UI         | 완료     | Streamlit 채팅 인터페이스           |
| LangSmith 연동    | 완료     | 자동 트레이싱 설정                  |
| LangGraph 연동    | 완료     | StateGraph 기반 워크플로우          |

8.2 GitHub 저장소
--------------------------------------------------------------------------------
- Repository: https://github.com/wasdq1234/chatbot-demo
- 최신 커밋: Phase 4-5 완료


9. 결론
================================================================================

본 프로젝트는 최신 AI 기술(LangChain, LangGraph)과 체계적인 모니터링
(LangSmith, LangGraph Studio)을 결합하여 안정적이고 확장 가능한 대화형
AI Agent를 구축합니다.

MVP 단계의 핵심 기능이 이미 구현되어 있으며, 제안된 로드맵에 따라
위치 기반 서비스와 카드 혜택 추천 기능을 고도화할 예정입니다.

주요 차별점:
- LangSmith를 통한 전체 LLM 호출 트레이싱 및 성능 모니터링
- LangGraph Studio를 통한 시각적 워크플로우 디버깅
- 체계적인 상태 관리 기반의 AI Agent 아키텍처

